@if (folderNode.parent) {
  <app-node-list-item
    [key]="folderNode.parent.path.key"
    [nodeType]="folderNode.parent.type"
    [defaultIcon]="folderNode.parent.mdIcon"
    [loadingStatus]="loadingStatus"
    [audioPlayerState]="audioPlayerState"
    [disabled]="folderNode.parent.disabled"
    [last]="dataSource.totalCount === 0"
    (contentClick)="onNodeClick($event)"
    >
    <div appNodeListItemTitle>
      ..
    </div>
  </app-node-list-item>
}

<cdk-virtual-scroll-viewport [itemSize]="56" class="file-explorer-viewport">
  <ng-container *cdkVirtualFor="let node of dataSource; let last = last">
    @if (node) {
      <app-node-list-item
        [key]="node.path.key"
        [nodeType]="node.type"
        [defaultIcon]="node.mdIcon"
        [loadingStatus]="loadingStatus"
        [audioPlayerState]="audioPlayerState"
        [disabled]="node.disabled"
        [last]="last"
        (contentClick)="onNodeClick($event)"
        >
        <div appNodeListItemTitle>
          {{ node.path.fileName }}
        </div>
        @if (node | instanceOf:FileExplorerFileNode; as fileNode) {
          <app-file-metadata-subtitle appNodeListItemSubtitle
            [metadata]="fileNode.metadata"
            />
        }
        @if (node | instanceOf:FileExplorerFileNode; as fileNode) {
          @if (fileNode.playbackSupported) {
            <app-add-to-queue-button
              [file]="fileNode"
              />
          }
          @if (fileNode.exists && !fileNode.hasTranscode) {
            <app-request-transcode-button
              [file]="fileNode"
              />
          }
          @if (fileNode.exists && isAdmin) {
            <app-copy-node
              [file]="fileNode"
              />
            <app-cut-node
              [file]="fileNode"
              />
            <app-delete-node
              [file]="fileNode"
              />
          }
        }
      </app-node-list-item>
    } @else {
      <app-node-list-item
        defaultIcon="description"
        [last]="last"
        >
        <div appNodeListItemTitle>
          &nbsp;
        </div>
      </app-node-list-item>
    }
  </ng-container>
</cdk-virtual-scroll-viewport>
